<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sunrun.mapper.DevTaskExecuteMapper">
	
	<insert id="saveDevTaskExecute">
		insert into dev_task_execute(
			id,						task_id,				task_type,				task_order,				task_describe,		execute_step,
			task_execute_state,		task_execute_note,		task_execute_begin,		task_execute_end,		create_time,		state,			create_user
		) values(
			#{execute.id}, 			#{execute.taskId},		#{execute.taskType},	#{execute.taskOrder}, 	#{execute.taskDescribe}, #{execute.executeStep},
			#{execute.taskExecuteState},#{execute.taskExecuteNote},	#{execute.taskExecuteBegin},#{execute.taskExecuteEnd},now(), 1,				#{execute.create_user}
		)
	</insert>
	
	<update id="updateDevTaskExecute">
		update dev_task_execute
		<trim prefix="set" suffixOverrides=",">
				update_time = now(),
				<if test="execute.executeStep != null">execute_step=#{execute.executeStep},</if>
				<if test="execute.taskOrder != null">task_order=#{execute.taskOrder},</if>
				<if test="execute.taskDescribe != null">task_describe=#{execute.taskDescribe},</if>
				<if test="execute.taskExecuteState != null">task_execute_state=#{execute.taskExecuteState},</if>
				<if test="execute.taskExecuteNote != null">task_execute_note=#{execute.taskExecuteNote},</if>
				<if test="execute.taskExecuteBegin != null">task_execute_begin=#{execute.taskExecuteBegin},</if>
				<if test="execute.taskExecuteEnd != null">task_execute_end=#{execute.taskExecuteEnd},</if>
				<if test="execute.state != null">state=#{execute.state},</if>
				<if test="execute.update_user != null">update_user=#{execute.update_user},</if>
			</trim>
		where 1=1  and state=1
		<if test="execute.id != null">
		    AND id = #{execute.id}
		</if>
		<if test="execute.taskId != null">
		    AND task_id = #{execute.taskId}
		</if>
		<if test="execute.executeStep != null">
		    AND execute_step = #{execute.executeStep}
		</if>
	</update>
	
	<delete id="deleteDevTaskExecute">
		delete from dev_task_execute where 1=1
		<if test="id != null">
		    AND id = #{id}
		</if>
		<if test="taskId != null">
		    AND task_id = #{taskId}
		</if>
	</delete>
	
	<select id="findTaskExecute" resultType="com.sunrun.entity.DevTaskExecute">
		select
			id AS id,
			task_id AS taskId,
			task_type AS taskType,
			task_order AS taskOrder,
			task_describe AS taskDescribe,
			task_execute_state AS taskExecuteState,
			task_execute_note AS taskExecuteNote,
			task_execute_begin AS taskExecuteBegin,
			task_execute_end AS taskExecuteEnd,
			execute_step AS executeStep,
			create_time AS create_time,
			create_user AS create_user,
			state AS state
		
		from dev_task_execute where state=1
		<if test="taskId != null">
		    AND task_id = #{taskId}
		</if>
		<if test="executeStep != null">
		    AND execute_step = #{executeStep}
		</if>
		<if test="order != null">
		   ORDER BY task_order DESC
		</if>
	</select>
	
	
</mapper>
